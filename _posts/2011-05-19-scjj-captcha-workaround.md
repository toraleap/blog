---
layout: post
title: 轻松绕过四川车牌自主选号的验证码
category: tech
---

本文针对四川交警机动车网上自主编号申请，地址是 <http://www.scjj.gov.cn。>

首先还是小小发表一下愤怒，这个选号网站做的奇烂无比：用 Chrome 登录弹出各种莫名其妙的对话框，因此被迫用 IE；还有那蛋疼的验证码，不管本次尝试有没有查到结果都得重输一遍，还是中文字母数字混合的，汉字也就那几个固定出现，输入次数多了严重影响我输入法的候选字排列；而且更气人的是，付出了这么多努力去输验证码，查过去查过来的满眼都是带“4”的牌照号，相信在国内没多少人愿意选择这个数字当车牌号吧。

![验证码](http://res.toraleap.com/images/20110518/selhp01.png)

出于对这验证码深深的厌恶，决定找到法子绕过去。首先找到验证码图片的链接是 showcode.aspx，没有跟任何请求参数，直接访问此地址报错，看样子需要有正确的 Cookies 才能生成验证码。于是开启 Fiddler 抓包跟踪，发现 Cookies 内容中仅有 ASP.NET 的 SessionID，据此判断验证码相关信息是存在服务器的 Session 上的。

接下来就要找到验证码更新的时机了。初步判断有两种可能，一种是访问 selhp.aspx 时更新，一种是访问 showcode.aspx 时更新。如果是前者就很麻烦了，因为整个表单提交时是传入 selhp.aspx 的，验证号牌信息时免不了会有这一次加载；但是如果是后者负责更新验证码，倒是应该有办法绕过。

查看网页源代码，发现 showcode.aspx 是网页中使用 img 标签载入的。屏蔽这个访问的方法自然很简单，直接到 IE 的选项里关掉显示图片就行了。如果成功，验证码将不再更新，即是永远使用先前的那个验证码就可以通过验证。

![IE设置](http://res.toraleap.com/images/20110518/selhp02.png)

说干就干，呵，成了！这下查询号牌就不用再管那烦人的验证码了，每次查完之后点击浏览器的后退按钮，验证码自动填好，只需要修改查询条件，继续下一次查询，这下可方便大了！

![绕过验证码](http://res.toraleap.com/images/20110518/selhp03.png)

当然绕过了验证码的话，忍不住就要兴奋一番，更进一步来个 Python 脚本批量查号了~

![批量查号](http://res.toraleap.com/images/20110518/selhp04.png)

本来已经从搜索范围里把“4”给去掉了，查询出来的结果仍然全是含“4”的也真是个杯具。当然写这个脚本就是纯属娱乐了，号码资源是动态的，想靠它找出全部可选号码没什么意义，仅仅从技术上验证一下可行性而已。

托这个绕过验证码方法的福，最后选到了一个比较满意的号码，也不枉这一番折腾了。顺便就悄悄的公布一下，造福一下同样被这验证码困扰的人们。